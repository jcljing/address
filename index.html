<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™¤ç”²é†›æ–½å·¥åŠ©æ‰‹ - åœ°å€æœç´¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: #f8f9fa; min-height: 100vh; padding: 20px 15px; }
        .container { max-width: 500px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 50px; height: 50px; background: #07c160; border-radius: 12px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; }
        .search-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        #searchInput { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; outline: none; }
        .city-row { display: flex; gap: 10px; }
        #citySelect { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: white; }
        #searchBtn { padding: 10px 20px; background: #07c160; color: white; border: none; border-radius: 8px; font-weight: bold; }
        .results-card { background: white; border-radius: 12px; margin-top: 15px; overflow: hidden; display: none; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .result-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; }
        .result-item:last-child { border-bottom: none; }
        .result-title { font-weight: bold; color: #333; }
        .result-address { font-size: 12px; color: #666; margin-top: 4px; }
        .action-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; display: none; gap: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .action-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; }
        .copy-btn { background: #07c160; color: white; }
        .nav-btn { background: #f0f2f5; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">ğŸ </div>
        <h2>å°åŒºåœ°å€æœç´¢</h2>
    </div>

    <div class="search-card">
        <input type="search" id="searchInput" placeholder="è¯·è¾“å…¥å°åŒºåç§°">
        <div class="city-row">
            <select id="citySelect">
                <option value="åŒ—äº¬">åŒ—äº¬å¸‚</option>
                <option value="ä¸Šæµ·">ä¸Šæµ·å¸‚</option>
                <option value="å¹¿å·">å¹¿å·å¸‚</option>
                <option value="æ·±åœ³">æ·±åœ³å¸‚</option>
            </select>
            <button id="searchBtn">æœç´¢</button>
        </div>
    </div>

    <div id="resultsCard" class="results-card">
        <div id="resultsList"></div>
    </div>
</div>

<div id="actionBar" class="action-bar">
    <button class="action-btn nav-btn" onclick="openNav()">ğŸ—ºï¸ å¯¼èˆª</button>
    <button class="action-btn copy-btn" onclick="copyAddr()">ğŸ“‹ å¤åˆ¶åœ°å€</button>
</div>

<script>
    const TENCENT_MAP_KEY = "LYQBZ-INAC4-MJ3UL-FVAGL-GYXH2-BYFSU";
    let searchResults = [];
    let selectedItem = null;

    document.getElementById('searchBtn').onclick = () => {
        const query = document.getElementById('searchInput').value.trim();
        if (query) performSearch(query);
    };

    // JSONP æœç´¢é€»è¾‘
    function performSearch(query) {
        const city = document.getElementById('citySelect').value;
        const callbackName = 'jsonp_callback_' + Math.round(Math.random() * 1000000);
        
        // 1. å®šä¹‰å›è°ƒ
        window[callbackName] = function(data) {
            delete window[callbackName];
            document.body.removeChild(document.getElementById(callbackName));
            
            if (data.status === 0 && data.data) {
                searchResults = data.data;
                renderList(data.data);
            } else {
                alert("æœç´¢å¤±è´¥: " + data.message);
            }
        };

        // 2. æ„é€  URL (å¿…é¡»å¸¦ output=jsonp)
        const url = `https://apis.map.qq.com/ws/place/v1/suggestion/?keyword=${encodeURIComponent(query)}&region=${encodeURIComponent(city)}&key=${TENCENT_MAP_KEY}&output=jsonp&callback=${callbackName}`;
        
        // 3. æ’å…¥ Script æ ‡ç­¾
        const script = document.createElement('script');
        script.id = callbackName;
        script.src = url;
        document.body.appendChild(script);
    }

    function renderList(items) {
        const card = document.getElementById('resultsCard');
        const list = document.getElementById('resultsList');
        card.style.display = 'block';
        list.innerHTML = items.map((item, i) => `
            <div class="result-item" onclick="selectItem(${i})">
                <div class="result-title">${item.title}</div>
                <div class="result-address">${item.address}</div>
            </div>
        `).join('');
    }

    function selectItem(i) {
        selectedItem = searchResults[i];
        document.getElementById('actionBar').style.display = 'flex';
        document.querySelectorAll('.result-item').forEach((el, idx) => {
            el.style.background = idx === i ? '#f0f7ff' : '#fff';
        });
    }

    function copyAddr() {
        const text = `${selectedItem.title} (${selectedItem.address})`;
        navigator.clipboard.writeText(text).then(() => alert("å·²å¤åˆ¶"));
    }

    function openNav() {
        const { lat, lng } = selectedItem.location;
        window.location.href = `https://apis.map.qq.com/uri/v1/routeplan?type=drive&to=${encodeURIComponent(selectedItem.title)}&tocoord=${lat},${lng}&referer=myapp`;
    }
</script>

</body>
</html>
