<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™¤ç”²é†›æ–½å·¥åŠ©æ‰‹ - åœ°å€æœç´¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, "Helvetica Neue", sans-serif; background: #f8f9fa; min-height: 100vh; padding: 20px 15px 100px; }
        .container { max-width: 500px; margin: 0 auto; }
        
        /* é¡¶éƒ¨æ ·å¼ */
        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 56px; height: 56px; background: linear-gradient(135deg, #07c160, #06ad56); border-radius: 14px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(7,193,96,0.2); }
        .logo span { font-size: 28px; }
        .header h1 { color: #333; font-size: 22px; font-weight: 600; }
        .header p { color: #888; font-size: 13px; margin-top: 4px; }
        
        /* æœç´¢åŒºåŸŸ */
        .search-card { background: white; border-radius: 12px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .search-box { position: relative; margin-bottom: 15px; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; z-index: 1; }
        #searchInput { width: 100%; padding: 12px 12px 12px 38px; border: 1px solid #e1e5e9; border-radius: 8px; font-size: 16px; outline: none; transition: border 0.3s; }
        #searchInput:focus { border-color: #07c160; }
        
        .city-row { display: flex; gap: 10px; align-items: center; }
        #citySelect { flex: 1; padding: 10px; border: 1px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: #fff; appearance: none; }
        #searchBtn { background: #07c160; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; }
        
        /* ç»“æœåŒºåŸŸ */
        .results-card { background: white; border-radius: 12px; overflow: hidden; display: none; box-shadow: 0 2px 12px rgba(0,0,0,0.05); }
        .result-item { padding: 15px; border-bottom: 1px solid #f0f0f0; transition: background 0.2s; }
        .result-item:last-child { border-bottom: none; }
        .result-item:active { background: #f0f7ff; }
        .result-title { font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px; }
        .result-address { font-size: 13px; color: #666; line-height: 1.4; }
        .result-tag { display: inline-block; font-size: 11px; color: #07c160; background: rgba(7,193,96,0.1); padding: 2px 6px; border-radius: 4px; margin-top: 6px; }

        /* åº•éƒ¨æ“ä½œæ  */
        .action-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 16px 20px env(safe-area-inset-bottom); display: none; gap: 12px; box-shadow: 0 -4px 12px rgba(0,0,0,0.08); z-index: 100; }
        .action-btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .copy-btn { background: #07c160; color: white; }
        .nav-btn { background: #f0f2f5; color: #333; }

        /* çŠ¶æ€æ˜¾ç¤º */
        .loading, .empty-state { text-align: center; padding: 40px 20px; color: #999; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #07c160; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.75); color: white; padding: 12px 24px; border-radius: 25px; font-size: 14px; z-index: 1000; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo"><span>ğŸ¡</span></div>
        <h1>æ–½å·¥åœ°å€ç²¾å‡†åŒ¹é…</h1>
        <p>ç”²é†›æ²»ç†é¡¹ç›®ä¸“ç”¨ - æ”¯æŒä¸€é”®å¤åˆ¶ä¸å¯¼èˆª</p>
    </div>

    <div class="search-card">
        <form action="javascript:void(0);" id="searchForm">
            <div class="search-box">
                <div class="search-icon">ğŸ”</div>
                <input type="search" id="searchInput" placeholder="è¾“å…¥å°åŒºæˆ–å¤§å¦åç§°" autocomplete="off">
            </div>
            <div class="city-row">
                <select id="citySelect">
                    <option value="ä¸Šæµ·">ä¸Šæµ·å¸‚</option>
                    <option value="åŒ—äº¬">åŒ—äº¬å¸‚</option>
                    <option value="å¹¿å·">å¹¿å·å¸‚</option>
                    <option value="æ·±åœ³">æ·±åœ³å¸‚</option>
                    <option value="æ­å·">æ­å·å¸‚</option>
                    <option value="å—äº¬">å—äº¬å¸‚</option>
                    <option value="è‹å·">è‹å·å¸‚</option>
                    <option value="æˆéƒ½">æˆéƒ½å¸‚</option>
                    <option value="æ­¦æ±‰">æ­¦æ±‰å¸‚</option>
                </select>
                <button type="submit" id="searchBtn">å¼€å§‹æœç´¢</button>
            </div>
        </form>
    </div>

    <div class="results-card" id="resultsCard">
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨æ‹‰å–æœ€æ–°ä½ç½®æ•°æ®...</p>
        </div>
        <div id="resultsList"></div>
    </div>
</div>

<div class="action-bar" id="actionBar">
    <button class="action-btn nav-btn" onclick="openNavigation()">ğŸ—ºï¸ å¯¼èˆª</button>
    <button class="action-btn copy-btn" onclick="copyAddress()">ğŸ“‹ å¤åˆ¶å®Œæ•´åœ°å€</button>
</div>

<div class="toast" id="toast">æç¤ºä¿¡æ¯</div>

<script>
    // é…ç½®ä¿¡æ¯ (è¯·åŠ¡å¿…åœ¨è…¾è®¯åœ°å›¾åå°é…ç½®åŸŸåç™½åå•)
    const TENCENT_MAP_KEY = "LYQBZ-INAC4-MJ3UL-FVAGL-GYXH2-BYFSU";
    
    let selectedItem = null;
    let searchResults = [];

    const searchInput = document.getElementById('searchInput');
    const searchForm = document.getElementById('searchForm');
    const resultsCard = document.getElementById('resultsCard');
    const resultsList = document.getElementById('resultsList');
    const loading = document.getElementById('loading');
    const actionBar = document.getElementById('actionBar');

    // æœç´¢å¤„ç†
    searchForm.addEventListener('submit', () => {
        const query = searchInput.value.trim();
        if (query) performSearch(query);
        searchInput.blur(); // æ”¶èµ·é”®ç›˜
    });

    // å®æ—¶è”åŠ¨ (é˜²æŠ–)
    let timer;
    searchInput.addEventListener('input', (e) => {
        clearTimeout(timer);
        timer = setTimeout(() => {
            const query = e.target.value.trim();
            if (query.length >= 2) performSearch(query);
        }, 500);
    });

    // æ ¸å¿ƒæŸ¥è¯¢å‡½æ•° (ä½¿ç”¨ JSONP è§£å†³è·¨åŸŸ)
    function performSearch(query) {
        const city = document.getElementById('citySelect').value;
        
        resultsCard.style.display = 'block';
        loading.style.display = 'block';
        resultsList.innerHTML = '';
        actionBar.style.display = 'none';

        // åˆ›å»ºå›è°ƒå‡½æ•°
        const callbackName = 'jsonp_callback_' + Math.round(Math.random() * 100000);
        window[callbackName] = function(data) {
            handleResponse(data);
            delete window[callbackName];
            document.body.removeChild(script);
        };

        const url = `https://apis.map.qq.com/ws/place/v1/suggestion/?keyword=${encodeURIComponent(query)}&region=${encodeURIComponent(city)}&key=${TENCENT_MAP_KEY}&output=jsonp&callback=${callbackName}`;
        
        const script = document.createElement('script');
        script.src = url;
        document.body.appendChild(script);
    }

    function handleResponse(data) {
        loading.style.display = 'none';
        if (data.status === 0 && data.data.length > 0) {
            searchResults = data.data;
            renderResults(data.data);
        } else {
            resultsList.innerHTML = `<div class="empty-state">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ<br><small>è¯·å°è¯•æ£€æŸ¥åŸå¸‚è®¾ç½®æˆ–æ›´æ¢å…³é”®è¯</small></div>`;
        }
    }

    function renderResults(items) {
        resultsList.innerHTML = items.map((item, index) => `
            <div class="result-item" onclick="selectItem(${index})">
                <div class="result-title">${item.title}</div>
                <div class="result-address">${item.address}</div>
                <div class="result-tag">${item.district || ''} ${item.category || 'åœ°ç‚¹'}</div>
            </div>
        `).join('');
    }

    function selectItem(index) {
        selectedItem = searchResults[index];
        
        // è§†è§‰åé¦ˆ
        document.querySelectorAll('.result-item').forEach((el, i) => {
            el.style.background = i === index ? '#f0f7ff' : '#fff';
            el.style.borderLeft = i === index ? '4px solid #07c160' : 'none';
        });

        actionBar.style.display = 'flex';
    }

    // å¤åˆ¶åŠŸèƒ½
    function copyAddress() {
        if (!selectedItem) return;
        const text = `${selectedItem.title}ï¼Œåœ°å€ï¼š${selectedItem.address}`;
        
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            showToast('âœ… åœ°å€å·²å¤åˆ¶ï¼Œå¯ç›´æ¥ç²˜è´´');
        } catch (err) {
            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é•¿æŒ‰');
        }
        document.body.removeChild(textarea);
    }

    // å¯¼èˆªåŠŸèƒ½
    function openNavigation() {
        if (!selectedItem) return;
        const { lat, lng } = selectedItem.location;
        const title = encodeURIComponent(selectedItem.title);
        
        // è…¾è®¯åœ°å›¾åè®®ï¼ˆå¾®ä¿¡å†…å…¼å®¹æ€§æœ€å¥½ï¼‰
        const url = `https://apis.map.qq.com/uri/v1/routeplan?type=drive&to=${title}&tocoord=${lat},${lng}&referer=PM_APP`;
        window.location.href = url;
    }

    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 2000);
    }
</script>

</body>
</html>
